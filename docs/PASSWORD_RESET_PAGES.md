# ุตูุญุงุช ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ

**ุงูุชุงุฑูุฎ:** 2025-01-16  
**ุงูุญุงูุฉ:** โ ููุชูู

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ูุงูู ูุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ูุชููู ูู ุซูุงุซ ุตูุญุงุช:
1. **ุตูุญุฉ ุทูุจ ุฅุนุงุฏุฉ ุงูุชุนููู** (`/forgot-password`)
2. **ุตูุญุฉ ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ** (`/reset-password`)
3. **ุตูุญุฉ OAuth Consent Callback** (`/reset-password/oauth/consent`)

---

## ๐ฏ ุงููููุงุช ุงูููุดุฃุฉ

### 1. ุงูุตูุญุงุช (SPA Pages)

#### `frontend/src/spa-pages/ForgotPasswordPage.tsx`
ุตูุญุฉ ุทูุจ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ.

**ุงููููุฒุงุช:**
- โ ูุงุฌูุฉ ูุณุชุฎุฏู ุฌูููุฉ ููุชุฌุงูุจุฉ
- โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- โ ุฑุณุงุฆู ูุฌุงุญ/ุฎุทุฃ ูุงุถุญุฉ
- โ ุฏุนู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
- โ ุฑุจุท ูุน Supabase Auth

#### `frontend/src/spa-pages/NewPasswordPage.tsx`
ุตูุญุฉ ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ ุจุนุฏ ุงูููุฑ ุนูู ุงูุฑุงุจุท.

**ุงููููุฒุงุช:**
- โ ุงูุชุญูู ูู ุตุญุฉ ุฑุงุจุท ุฅุนุงุฏุฉ ุงูุชุนููู
- โ ุงูุชุญูู ูู ุชุทุงุจู ูููุงุช ุงููุฑูุฑ
- โ ุงูุชุญูู ูู ููุฉ ูููุฉ ุงููุฑูุฑ (8 ุฃุญุฑู ุนูู ุงูุฃูู)
- โ ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุนุจุฑ Supabase
- โ ุงูุชูุฌูู ุงูุชููุงุฆู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู ุจุนุฏ ุงููุฌุงุญ

#### `frontend/app/reset-password/oauth/consent/page.tsx`
ุตูุญุฉ ูุนุงูุฌุฉ OAuth consent callbacks ุฎูุงู ุนูููุฉ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ.

**ุงููููุฒุงุช:**
- โ ูุนุงูุฌุฉ OAuth callbacks ูู Supabase
- โ ุงุณุชุฎุฑุงุฌ tokens ูู URL hash
- โ ุฅูุดุงุก session ูู tokens
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุดุงูู
- โ ุญุงูุงุช UI: processing, success, error
- โ ุฅุนุงุฏุฉ ุงูุชูุฌูู ุงูุชููุงุฆู ุฅูู `/reset-password`
- โ ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ ุงูุตุญูุญุฉ (cleanup functions)
- โ Accessibility features (ARIA labels)
- โ ุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ

### 2. Hooks

#### `frontend/src/hooks/useResetPassword.ts`
Hook ูุทูุจ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ.

**ุงูุงุณุชุฎุฏุงู:**
```typescript
const resetPasswordMutation = useResetPassword();

await resetPasswordMutation.mutateAsync(email);
```

#### `frontend/src/hooks/useUpdatePassword.ts`
Hook ูุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ.

**ุงูุงุณุชุฎุฏุงู:**
```typescript
const updatePasswordMutation = useUpdatePassword();

await updatePasswordMutation.mutateAsync({
  password: 'NewPassword123!',
  confirmPassword: 'NewPassword123!',
});
```

### 3. ุตูุญุงุช Next.js

#### `frontend/app/forgot-password/page.tsx`
ุตูุญุฉ Next.js ูุทูุจ ุฅุนุงุฏุฉ ุงูุชุนููู.

#### `frontend/app/reset-password/page.tsx`
ุตูุญุฉ Next.js ูุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ.

#### `frontend/app/reset-password/oauth/consent/page.tsx`
ุตูุญุฉ Next.js ููุนุงูุฌุฉ OAuth consent callbacks.

---

## ๐ ุงูุชุฏูู ุงููุงูู

### ุงูุฎุทูุฉ 1: ุทูุจ ุฅุนุงุฏุฉ ุงูุชุนููู
1. ุงููุณุชุฎุฏู ูุฐูุจ ุฅูู `/forgot-password`
2. ูุฏุฎู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
3. ูุถุบุท "ุฅุฑุณุงู ุฑุงุจุท ุฅุนุงุฏุฉ ุงูุชุนููู"
4. ูุชู ุฅุฑุณุงู ุฑุงุจุท ุฅุนุงุฏุฉ ุงูุชุนููู ุฅูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

### ุงูุฎุทูุฉ 2: ุงูููุฑ ุนูู ุงูุฑุงุจุท
1. ุงููุณุชุฎุฏู ููุชุญ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
2. ูููุฑ ุนูู ุฑุงุจุท ุฅุนุงุฏุฉ ุงูุชุนููู
3. ูุชู ุชูุฌููู ุฅูู `/reset-password` ูุน token ูู URL

### ุงูุฎุทูุฉ 3: OAuth Consent (ุงุฎุชูุงุฑู)
1. ุฅุฐุง ุงุณุชุฎุฏู ุงููุณุชุฎุฏู OAuth providerุ ูุชู ุฅุนุงุฏุฉ ุชูุฌููู ุฅูู `/reset-password/oauth/consent`
2. ูุชู ุงุณุชุฎุฑุงุฌ tokens ูู URL hash
3. ูุชู ุฅูุดุงุก session ูู tokens
4. ูุชู ุงูุชูุฌูู ุฅูู `/reset-password`

### ุงูุฎุทูุฉ 4: ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ
1. ูุชู ุงูุชุญูู ูู ุตุญุฉ token ุชููุงุฆูุงู
2. ุงููุณุชุฎุฏู ูุฏุฎู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ
3. ุงููุณุชุฎุฏู ูุคูุฏ ูููุฉ ุงููุฑูุฑ
4. ูุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ูู Supabase
5. ูุชู ุงูุชูุฌูู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู

---

## ๐ ุงูุฑูุงุจุท

### ุงูุตูุญุงุช:
- **ุทูุจ ุฅุนุงุฏุฉ ุงูุชุนููู:** `/forgot-password`
- **ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ:** `/reset-password`
- **OAuth Consent Callback:** `/reset-password/oauth/consent`
- **ุชุณุฌูู ุงูุฏุฎูู:** `/login` (ูุญุชูู ุนูู ุฑุงุจุท "ูุณูุช ูููุฉ ุงููุฑูุฑุ")

### ุงูุชูุงูู:
- โ ุฑุงุจุท ูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู โ `/forgot-password`
- โ ุฑุงุจุท ูู ุตูุญุฉ ุทูุจ ุฅุนุงุฏุฉ ุงูุชุนููู โ `/login`
- โ ุงูุชูุฌูู ุงูุชููุงุฆู ุจุนุฏ ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ โ `/login?passwordUpdated=true`
- โ OAuth Consent โ `/reset-password` (ุจุนุฏ ูุนุงูุฌุฉ tokens)
- โ ุตูุญุฉ OAuth Consent ูุณุฌูุฉ ูู `middleware.ts` ูุตูุญุฉ ุนุงูุฉ

---

## ๐๏ธ ุงูุฅุนุฏุงุฏุงุช ุงููุทููุจุฉ

### Supabase Configuration
ุชุฃูุฏ ูู ุฅุนุฏุงุฏ Supabase Email Templates:

1. ุงุฐูุจ ุฅูู [Supabase Dashboard](https://supabase.com/dashboard)
2. **Authentication** > **Email Templates**
3. ุชุฃูุฏ ูู ุฃู **Reset Password** template ููุนุฏ ุจุดูู ุตุญูุญ
4. ุชุฃูุฏ ูู ุฃู **Redirect URL** ูุดูุฑ ุฅูู: `https://yourdomain.com/reset-password`

### Environment Variables
```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

---

## ๐ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### ุฃุฎุทุงุก ุดุงุฆุนุฉ:

| ุงูุฎุทุฃ | ุงูุณุจุจ | ุงูุญู |
|------|-------|------|
| Invalid email | ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุบูุฑ ุตุญูุญ | ุงูุชุญูู ูู ุตุญุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู |
| Rate limit | ูุญุงููุงุช ูุซูุฑุฉ | ุงูุงูุชุธุงุฑ ููููุงู ูุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู |
| Invalid/expired token | ุฑุงุจุท ููุชูู ุงูุตูุงุญูุฉ | ุทูุจ ุฑุงุจุท ุฌุฏูุฏ |
| Password mismatch | ูููุงุช ุงููุฑูุฑ ุบูุฑ ูุชุทุงุจูุฉ | ุงูุชุฃูุฏ ูู ุชุทุงุจู ูููุงุช ุงููุฑูุฑ |
| Weak password | ูููุฉ ุงููุฑูุฑ ุถุนููุฉ | ุงุณุชุฎุฏุงู ูููุฉ ูุฑูุฑ ุฃููู (8+ ุฃุญุฑู) |

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุญุงูุงุช ุงูุงุฎุชุจุงุฑ:

1. โ ุทูุจ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ
2. โ ุงูุชุญูู ูู ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
3. โ ุงูููุฑ ุนูู ุฑุงุจุท ุฅุนุงุฏุฉ ุงูุชุนููู
4. โ ูุนุงูุฌุฉ OAuth consent callback (ุฅุฐุง ูุงู ูุณุชุฎุฏูุงู)
5. โ ุงูุชุญูู ูู ุตุญุฉ token
6. โ ุฅุฏุฎุงู ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ
7. โ ุงูุชุญูู ูู ุชุทุงุจู ูููุงุช ุงููุฑูุฑ
8. โ ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ
9. โ ุงูุชูุฌูู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
10. โ ุชุณุฌูู ุงูุฏุฎูู ุจูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ

---

## ๐ OAuth Consent Callback

### ูุธุฑุฉ ุนุงูุฉ
ุตูุญุฉ `/reset-password/oauth/consent` ุชุนุงูุฌ OAuth consent callbacks ุงูุชู ูุฏ ูุฑุณููุง Supabase ุฎูุงู ุนูููุฉ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑุ ุฎุงุตุฉ ุนูุฏ ุงุณุชุฎุฏุงู OAuth providers (ูุซู Google, GitHub, etc.).

### ููู ูุนูู

1. **ุงุณุชูุจุงู Callback**
   - Supabase ูุฏ ูุนูุฏ ุชูุฌูู ุงููุณุชุฎุฏู ุฅูู ูุฐู ุงูุตูุญุฉ ุจุนุฏ OAuth consent
   - Tokens ููุฌูุฏุฉ ูู URL hash (`#access_token=...&refresh_token=...`)

2. **ุงุณุชุฎุฑุงุฌ Tokens**
   - ูุชู ุงุณุชุฎุฑุงุฌ `access_token` ู `refresh_token` ูู URL hash
   - ูุชู ุฃูุถุงู ูุญุต query parameters ููุฃุฎุทุงุก (`?error=...`)

3. **ุฅูุดุงุก Session**
   - ูุชู ุงุณุชุฎุฏุงู `supabase.auth.setSession()` ูุฅูุดุงุก session ูู tokens
   - ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุฏูู session ูุดุท ุจุงููุนูุ ูุชู ุงูุชูุฌูู ูุจุงุดุฑุฉ

4. **ุงูุชูุฌูู**
   - ุจุนุฏ ุฅูุดุงุก session ุจูุฌุงุญุ ูุชู ุงูุชูุฌูู ุฅูู `/reset-password`
   - ูู ุญุงูุฉ ุงูุฃุฎุทุงุกุ ูุชู ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ ูุฅุนุงุฏุฉ ุงูุชูุฌูู ุจุนุฏ 3 ุซูุงู

### ุญุงูุงุช ุงูุตูุญุฉ

#### Processing
- ูุนุฑุถ spinner ุฃุซูุงุก ูุนุงูุฌุฉ OAuth callback
- ุฑุณุงูุฉ: "ุฌุงุฑู ูุนุงูุฌุฉ ุทูุจ OAuth..."

#### Success
- ูุนุฑุถ ุนูุงูุฉ ูุฌุงุญ (checkmark)
- ุฑุณุงูุฉ: "ุชู ุชุฃููุฏ OAuth ุจูุฌุงุญ. ุฌุงุฑู ุงูุชูุฌูู..."
- ุฅุนุงุฏุฉ ุชูุฌูู ุชููุงุฆูุฉ ุจุนุฏ 1 ุซุงููุฉ

#### Error
- ูุนุฑุถ ุฃููููุฉ ุฎุทุฃ
- ุฑุณุงูุฉ ุงูุฎุทุฃ ูู Supabase ุฃู ุฑุณุงูุฉ ุงูุชุฑุงุถูุฉ
- ุฅุนุงุฏุฉ ุชูุฌูู ุชููุงุฆูุฉ ุจุนุฏ 3 ุซูุงู ุฅูู `/reset-password`

### ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

ุงูุตูุญุฉ ุชุชุนุงูู ูุน ุงูุฃุฎุทุงุก ุงูุชุงููุฉ:
- **OAuth Errors**: ุฃุฎุทุงุก ูู OAuth provider (ูุชู ุงุณุชุฎุฑุงุฌูุง ูู URL)
- **Session Errors**: ูุดู ูู ุฅูุดุงุก session ูู tokens
- **Missing Tokens**: ุนุฏู ูุฌูุฏ tokens ูู URL
- **Network Errors**: ูุดุงูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู

### ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ

ุงูุตูุญุฉ ุชุณุชุฎุฏู cleanup functions ูุชุฌูุจ memory leaks:
- ุชูุธูู timeouts ุนูุฏ unmounting
- ุงุณุชุฎุฏุงู `isMounted` flag ูุชุฌูุจ state updates ุจุนุฏ unmount

---

## ๐ ุงูุฃูุงู

### ุงูููุฒุงุช ุงูุฃูููุฉ:

1. **ุนุฏู ุงููุดู ุนู ูุฌูุฏ ุงููุณุชุฎุฏู**
   - ุฑุณุงูุฉ ููุญุฏุฉ ุญุชู ูู ูู ููู ุงููุณุชุฎุฏู ููุฌูุฏุงู
   - ููุน enumeration attacks

2. **ุงูุชุญูู ูู ุตุญุฉ Token**
   - ุงูุชุญูู ูู ุตุญุฉ token ูุจู ุงูุณูุงุญ ุจุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ
   - ุฑูุถ tokens ุงูููุชููุฉ ุงูุตูุงุญูุฉ

3. **ุงูุชุญูู ูู ููุฉ ูููุฉ ุงููุฑูุฑ**
   - ุงูุญุฏ ุงูุฃุฏูู 8 ุฃุญุฑู
   - ูููู ุฅุถุงูุฉ ูุชุทูุจุงุช ุฅุถุงููุฉ ูุงุญูุงู

4. **Rate Limiting**
   - Supabase ูุทุจู rate limiting ุชููุงุฆูุงู
   - ููุน abuse

---

## ๐ ุงููุฑุงุฌุน

- [Supabase Auth Documentation](https://supabase.com/docs/guides/auth)
- [Supabase Password Reset](https://supabase.com/docs/reference/javascript/auth-resetpasswordforemail)
- [Supabase Update User](https://supabase.com/docs/reference/javascript/auth-updateuser)

---

## โ ุงูุฎูุงุตุฉ

ุชู ุฅูุดุงุก ูุธุงู ูุงูู ูุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ:
- โ ุตูุญุฉ ุทูุจ ุฅุนุงุฏุฉ ุงูุชุนููู (`/forgot-password`)
- โ ุตูุญุฉ ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ (`/reset-password`)
- โ ุตูุญุฉ OAuth Consent Callback (`/reset-password/oauth/consent`)
- โ Hooks ููุชุนุงูู ูุน Supabase
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ
- โ ูุงุฌูุฉ ูุณุชุฎุฏู ุฌูููุฉ ููุชุฌุงูุจุฉ
- โ ุฏุนู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
- โ ุฑุจุท ูุน ูุธุงู ุงูุชูุฌูู
- โ ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ ุงูุตุญูุญุฉ (cleanup functions)
- โ Accessibility features (ARIA labels)

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ๐

