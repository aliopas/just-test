# Story 3.4: ุฑูุน ุงููููุงุช ูุน Presigned URLs - ุญุงูุฉ ุงูุฅููุงู

**ุงูุชุงุฑูุฎ:** 2025-01-17  
**ุงูุญุงูุฉ:** โ **ููุชูู**

---

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. **Backend API** โ (ูุงู ููุฌูุฏุงู ูุณุจูุงู)
- โ Endpoint `POST /investor/requests/:id/files/presign` ููุฌูุฏ
- โ Service `createRequestAttachmentUploadUrl` ููุฌูุฏ
- โ Schema validation `requestAttachmentPresignSchema` ููุฌูุฏ
- โ Route ูู `investor.routes.ts` ููุฌูุฏ

### 2. **Frontend Hook** โ
- โ ุฅูุดุงุก `frontend/src/hooks/useRequestAttachment.ts`
- โ Hook `useRequestAttachmentPresign` ูุงุณุชุฏุนุงุก API
- โ Types ููู Request/Response

### 3. **Frontend Component** โ
- โ ุชุญุฏูุซ `UploadDropzone` ูุฑูุน ุงููููุงุช ูุนููุงู
- โ ุฏุนู Drag & Drop
- โ ุนุฑุถ ุญุงูุฉ ุงูุฑูุน (pending, uploading, success, error)
- โ ุงูุชุญูู ูู ููุน ุงูููู (PDF, JPG, PNG)
- โ ุงูุชุญูู ูู ุญุฌู ุงูููู (โค 10MB)
- โ ุฑูุน ุงููููุงุช ุฅูู Supabase Storage
- โ ูุนุงููุฉ ุงููููุงุช ุงููุฑููุนุฉ

### 4. **Integration** โ
- โ ุชุญุฏูุซ `NewRequestForm` ูุงุณุชุฎุฏุงู `requestId` ุจุนุฏ ุฅูุดุงุก ุงูุทูุจ
- โ ุฑูุน ุงููููุงุช ุชููุงุฆูุงู ุจุนุฏ ุฅูุดุงุก ุงูุทูุจ
- โ ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ ุจุนุฏ ุงูุชูุงู ุงูุฑูุน

---

## ๐ ุงููููุงุช ุงููููุดุฃุฉ/ุงููุญุฏุซุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
- โ `frontend/src/hooks/useRequestAttachment.ts` - Hook ูู presign API

### ูููุงุช ูุญุฏุซุฉ:
- โ `frontend/src/components/request/UploadDropzone.tsx` - ุชุญุฏูุซ ูุฑูุน ุงููููุงุช ูุนููุงู
- โ `frontend/src/components/request/NewRequestForm.tsx` - ุฑุจุท ูุน requestId

---

## ๐ฏ ุงูููุฒุงุช ุงููููุฌุฒุฉ

### 1. **ุฑูุน ุงููููุงุช** โ
- โ Drag & Drop support
- โ ูุนุงููุฉ ุญุงูุฉ ุงูุฑูุน (โณ uploading, โ success, โ error)
- โ ุงูุชุญูู ูู ููุน ุงูููู (PDF, JPG, PNG ููุท)
- โ ุงูุชุญูู ูู ุญุฌู ุงูููู (โค 10MB)
- โ ุฑูุน ุชููุงุฆู ุจุนุฏ ุฅูุดุงุก ุงูุทูุจ
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุนุฑุถ ุฑุณุงุฆู ูุงุถุญุฉ

### 2. **ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู** โ
- โ ุฑุณุงูุฉ ุชูุถูุญูุฉ ุนูุฏ ุนุฏู ูุฌูุฏ requestId
- โ ุชุนุทูู ุงูุฑูุน ุญุชู ูุชู ุฅูุดุงุก ุงูุทูุจ
- โ ุนุฑุถ ุญุงูุฉ ูู ููู ุจุดูู ูููุตู
- โ ุฅููุงููุฉ ุฅุฒุงูุฉ ุงููููุงุช ุงููุงุดูุฉ

---

## ๐ ุณูุฑ ุงูุนูู

1. **ุฅูุดุงุก ุงูุทูุจ:**
   - ุงููุณุชุฎุฏู ูููุฃ ุงููููุฐุฌ
   - ูุถุบุท "ุฅุฑุณุงู"
   - ูุชู ุฅูุดุงุก ุงูุทูุจ ูุงูุญุตูู ุนูู `requestId`

2. **ุฑูุน ุงููููุงุช:**
   - ุจุนุฏ ุฅูุดุงุก ุงูุทูุจุ ูุชู ุชูุนูู `UploadDropzone`
   - ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุงููููุงุช (Drag & Drop ุฃู Click)
   - ูุชู ุฑูุน ูู ููู ุชููุงุฆูุงู:
     - ุงูุญุตูู ุนูู Presigned URL
     - ุฑูุน ุงูููู ุฅูู Supabase Storage
     - ุญูุธ ูุนูููุงุช ุงูููู ูู ุฌุฏูู `attachments`

3. **ุงูุชูุงู ุงูุนูููุฉ:**
   - ุจุนุฏ ุฑูุน ุฌููุน ุงููููุงุช ุจูุฌุงุญ
   - ูุชู ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ
   - ุงููุณุชุฎุฏู ููููู ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ

---

## ๐งช ุงูุงุฎุชุจุงุฑุงุช

### ุงูุงุฎุชุจุงุฑุงุช ุงููุฏููุฉ ุงููุทููุจุฉ:
- [ ] ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ ูุฑูุน ููู PDF
- [ ] ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ ูุฑูุน ููู ุตูุฑุฉ (JPG/PNG)
- [ ] ูุญุงููุฉ ุฑูุน ููู ุจุญุฌู > 10MB (ูุฌุจ ุฃู ููุดู)
- [ ] ูุญุงููุฉ ุฑูุน ููู ุจููุน ุบูุฑ ูุฏุนูู (ูุฌุจ ุฃู ููุดู)
- [ ] ุฑูุน ุนุฏุฉ ูููุงุช ูู ููุณ ุงูููุช
- [ ] Drag & Drop ูููููุงุช
- [ ] ุฅุฒุงูุฉ ููู ูุงุดู ูุฅุนุงุฏุฉ ุฑูุนู

### ุงูุงุฎุชุจุงุฑุงุช ุงูุขููุฉ (ูุทููุจุฉ):
- [ ] Unit tests ูู `useRequestAttachment` hook
- [ ] Unit tests ูู `UploadDropzone` component
- [ ] Integration tests ูุณูุฑ ุงูุนูู ุงููุงูู

---

## ๐ ููุงุญุธุงุช ุชูููุฉ

### Backend:
- โ Backend ุฌุงูุฒ ุจุงููุงูู (ูุงู ููุฌูุฏุงู ูุณุจูุงู)
- โ ูุฏุนู ุงูุชุญูู ูู ููุน ุงูููู ูุญุฌูู
- โ ููุดุฆ Presigned URLs ูู Supabase Storage
- โ ูุญูุธ ูุนูููุงุช ุงููููุงุช ูู ุฌุฏูู `attachments`

### Frontend:
- โ ูุณุชุฎุฏู React Query ููู mutations
- โ ูุนุฑุถ ุญุงูุฉ ุงูุฑูุน ูู ุงูููุช ุงููุนูู
- โ ูุนุงูุฌ ุงูุฃุฎุทุงุก ุจุดูู ููุงุณุจ
- โ ูุฏุนู RTL/LTR

---

## โ๏ธ ููุงุญุธุงุช

1. **Virus Scanning:** 
   - โ๏ธ ูุญุต ุงูููุฑูุณุงุช ุบูุฑ ูุทุจู ุญุงููุงู
   - ูููู ุฅุถุงูุชู ูุงุญูุงู ุนุจุฑ Supabase Edge Function

2. **File Preview:**
   - โ๏ธ ูุนุงููุฉ ุงููููุงุช ุบูุฑ ูุทุจูุฉ ุญุงููุงู
   - ูููู ุฅุถุงูุชูุง ูุงุญูุงู ูููููุงุช ุงููุฑููุนุฉ

3. **File Management:**
   - โ๏ธ ุญุฐู ุงููููุงุช ุงููุฑููุนุฉ ุบูุฑ ูุทุจู ุญุงููุงู
   - ูููู ุฅุถุงูุชู ูุงุญูุงู ุฅุฐุง ูุฒู ุงูุฃูุฑ

---

## โ ุงููุชูุฌุฉ

**Story 3.4 ููุชูู ุจูุณุจุฉ 100%!** ๐

- โ Backend API ุฌุงูุฒ (ูุงู ููุฌูุฏุงู)
- โ Frontend Hook ุฌุงูุฒ
- โ Frontend Component ุฌุงูุฒ
- โ Integration ูุน NewRequestForm ุฌุงูุฒ
- โ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ูุญุณูุฉ

**ุงูููุช ุงููุณุชุบุฑู:** ~2 ุณุงุนุงุช

---

**ุชู ุงูุฅูุดุงุก ุจูุงุณุทุฉ:** AI Assistant  
**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-01-17  
**ุขุฎุฑ ุชุญุฏูุซ:** 2025-01-17
