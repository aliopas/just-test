# Story 3.1: ุฅูุดุงุก ุฌุฏุงูู ุงูุทูุจุงุช ูุงููููุงุช โ ุญุงูุฉ ุงูุฅููุงู

**ุงูุชุงุฑูุฎ:** 2025-11-08  
**ุงูุญุงูุฉ:** โ ููุชูู

---

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ
- ุชู ุชูููุฑ/ุชุฃููุฏ ุงูุฌุฏุงูู ุงูุชุงููุฉ ุนุจุฑ ุงููุฌุฑุฉ `20241108073000_requests_rls.sql`:
  - `requests`  
    - ุงูุญููู ุงูุฃุณุงุณูุฉ (`id`, `request_number`, `user_id`, `type`, `amount`, `currency`, `target_price`, `expiry_at`, `status`, `notes`, `created_at`, `updated_at`)
    - ุชุญูู ุงูููุน (`buy` | `sell`) ูุงูุชุญูู ูู ุฃู ุงููุจูุบ ุฃูุจุฑ ูู ุตูุฑ.
    - Trigger `trg_requests_updated_at` ูุชุญุฏูุซ ุงูุญูู `updated_at` ุชููุงุฆููุง.
  - `request_events`  
    - ูุณุฌู ุงูุงูุชูุงูุงุช ุจูู ุงูุญุงูุงุช ูุน `actor_id`, `note`, `created_at`.
  - `attachments`  
    - ุญูุธ ุจูุงูุงุช ุงููููุงุช ุงููุฑููุนุฉ (`storage_key`, `mime_type`, `size`, โฆ).

### 2. ุงูููุงุฑุณ ูุงูุฃุฏุงุก
- ููุงุฑุณ ูุญุณููุฉ:
  - `idx_requests_user_status (user_id, status)` ูุทูุจุงุช ุงููุณุชุซูุฑ ุญุณุจ ุงูุญุงูุฉ.
  - `idx_requests_created_at` ูููุฑุฒ ุงูุฒููู.
  - ููุงุฑุณ ูุดุงุจูุฉ ุนูู `request_events` ู`attachments` (ุญุณุจ `request_id`, `created_at`).

### 3. ุณูุงุณุงุช RLS
- ุชู ุชูููู Row Level Security ุนูู ุงูุฌุฏุงูู ุงูุซูุงุซุฉ.
- ุณูุงุณุงุช ุงููุณุชุซูุฑ (ุงููุงูู):
  - ูุฑุงุกุฉ ูุชุนุฏูู ุณุฌูุงุชู ูู `requests`.
  - ูุฑุงุกุฉ/ุฅุฏุฑุงุฌ ูู `request_events` ู`attachments` ุงูุฎุงุตุฉ ุจุทูุจุงุชู.
- ุณูุงุณุงุช ุงูุฃุฏูู (`admin.requests.review`):
  - ุตูุงุญูุงุช ูุงููุฉ ุนูู ุงูุฌุฏุงูู ุงูุซูุงุซุฉ ูุฏุนู ุณูุฑ ุนูู ุงููุฑุงุฌุนุฉ.
- ุงูุณูุงุณุงุช ุชูููุฑ ุงูุฃุณุงุณ ูููุงุนุฏ ุงูุญุงูุฉ ุงูุชู ุณูุชู ุชูููุฐูุง ูู Story 3.2.

### 4. ุงูุชูุงูู ูุน ุงููุจูู
- ุฌููุน ุดุฑูุท Story 3.1 ูุญููุฉ: ุงูุฌุฏุงููุ ุงูุนูุงูุงุชุ ุงูููุงุฑุณุ ุงูู Triggerุ ูRLS.
- ูุง ุชูุฌุฏ ุชุบููุฑุงุช ุนูู ุงูููุฏ ุงูุฎููู ุจุนุฏ (ุณูุชู ุจูุงุก ุงูุฎุฏูุงุช/ุงููุงุฌูุงุช ูู ุงููุตุต ุงูุชุงููุฉ).

---

## ๐งช ุงูุงุฎุชุจุงุฑุงุช
- ูุง ุชูุฌุฏ ุงุฎุชุจุงุฑุงุช ุฌุฏูุฏุฉ (ุชุบููุฑุงุช ูุงุนุฏุฉ ุจูุงูุงุช ููุท).  
- ุชู ุชุดุบูู `npm run build` ู `npm run lint` ุณุงุจููุง ููุชุฃูุฏ ูู ุณูุงูุฉ ุงููุดุฑูุน ุจุนุฏ ุงููุฌุฑุงุช.

---

## ๐ ุงููููุงุช ุงูููุดุฃุฉ / ุงููุญุฏุซุฉ
- `supabase/migrations/20241108073000_requests_rls.sql` (ูุฌุฑุฉ Story 3.1).
- ูุณุชูุฏ ุงูุญุงูุฉ ุงูุญุงูู `docs/stories/STORY_3.1_COMPLETION.md`.

---

## ๐ ููุงุญุธุงุช
- ูู ุงููุตุต ุงููุงุญูุฉ ุณูุชู ุจูุงุก State Machine (Story 3.2) ูAPIs (Story 3.3+) ูุน ุงูุงุนุชูุงุฏ ุนูู ูุฐู ุงูุฌุฏุงูู ูุงูุณูุงุณุงุช.
- ุนูุฏ ุจูุงุก ูุงุฌูุฉ ุงููููุงุชุ ุณูุชู ุงุณุชุฎุฏุงู `storage_key` ูุงูู bucket ุงููุญุฏูุฏ ูู Supabase Storage.

---

**ุชู ุงูุฅูุดุงุก ุจูุงุณุทุฉ:** GPT-5 Codex (Cursor)  
**ุขุฎุฑ ุชุญุฏูุซ:** 2025-11-08  

