# Story 2.6: ุฅูุดุงุก ูุณุชุซูุฑ ูู ููุญุฉ ุงูุฃุฏูู โ ุญุงูุฉ ุงูุฅููุงู

**ุงูุชุงุฑูุฎ:** 2025-01-16  
**ุงูุญุงูุฉ:** โ ููุชูู (ุชูููุฐ ุจุฏูู)

---

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. API Endpoint โ
- โ **ุงููุงูุน:** `POST /admin/users` (ุจุฏูุงู ูู `/admin/investors` ููุง ูู PRD)
- โ **ุงูููุทู:** ููุณ ุงูู endpoint ูููู ุงุณุชุฎุฏุงูู ูุฅูุดุงุก ุฃู ูุณุชุฎุฏู (investor ุฃู admin)
- โ Controller: `backend/src/controllers/admin-user.controller.ts::createUser`
- โ Route: `backend/src/routes/admin.routes.ts`

### 2. Payload Support โ
- โ ุจูุงูุงุช ุงูุญุณุงุจ:
  - `email` (ูุทููุจ) โ
  - `phone` (E.164 format) โ
  - `fullName` โ
  - `locale` (preferred_language) โ
  - โ๏ธ `marketing_opt_in` - **ุบูุฑ ููุฌูุฏ** (ูุฏ ูุญุชุงุฌ ุฅุถุงูุฉ)

- โ ุจูุงูุงุช ุงูููู ุงูุดุฎุตู:
  - `nationality` โ
  - `residencyCountry` โ
  - `city` โ
  - `idType` โ
  - `idNumber` โ
  - `riskProfile` โ

- โ ุฎูุงุฑุงุช ุงูุชุญูู:
  - `sendInvite` (boolean) โ
  - `temporaryPassword` (string optional) โ
  - `status` (active|pending|suspended) โ

- โ๏ธ `documents` (array of presigned storage keys) - **ุบูุฑ ููุฌูุฏ** (ุณูุชู ูู Epic 3)

### 3. ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช โ
- โ Schema validation: `backend/src/schemas/admin-users.schema.ts`
- โ ุงุณุชุฎุฏุงู Zod ููุชุญูู
- โ ุฑุณุงุฆู ุฎุทุฃ ูุชุฑุฌูุฉ
- โ ุชุฎุฒูู ุงูุฃุฎุทุงุก ูู console logging

### 4. Supabase Admin API Integration โ
- โ ุงุณุชุฎุฏุงู `auth.admin.createUser` ูุฅูุดุงุก ุงููุณุชุฎุฏู
- โ ุฅุณูุงุฏ ูููุฉ ูุฑูุฑ ูุคูุชุฉ (ุฅุฐุง ูู ูุชู ุฅุฑุณุงู ุฏุนูุฉ)
- โ ุฅุฑุณุงู ุฑุงุจุท ุฏุนูุฉ (ุฅุฐุง `sendInvite = true`)

### 5. ุฅูุดุงุก `investor_profiles` โ
- โ ุฅูุดุงุก ุณุฌู ุชููุงุฆู ูู `investor_profiles`
- โ ุฑุจุท ุจุงููุณุชุฎุฏู ุงูุฌุฏูุฏ
- โ ุชุญุฏูุฏ ุญุงูุฉ KYC ุงูุฃูููุฉ (ูุงุจูุฉ ููุชุญุฏูุฏุ default: pending)

### 6. ุฑุจุท ุงูุฏูุฑ Investor โ
- โ ุฑุจุท ุงููุณุชุฎุฏู ุจุฏูุฑ Investor ุนุจุฑ `user_roles`
- โ ุชุณุฌูู ูู ูุงู ุจุงูุนูููุฉ (`assigned_by = actorId`)
- โ ุงุณุชุฎุฏุงู `rbacService.assignRole()`

### 7. ุญูุธ ุงููุซุงุฆู โ๏ธ
- โ๏ธ **ููููุฏ:** ุญูุธ Metadata ูู ุฌุฏูู `attachments`
- โ๏ธ **ุณุจุจ:** ุณูุชู ุชูููุฐูุง ูู Epic 3 (ูุธุงู ุงููููุงุช ูุงููุฑููุงุช)

### 8. ุชุณุฌูู Audit Logs โ
- โ ุชุณุฌูู ูู ุนูููุฉ ูู `audit_logs`
- โ Payload ูุงูู ูุน diff
- โ ุชุณุฌูู ูู ููุฐ ุงูุนูููุฉ (`actorId`)
- โ ุชุณุฌูู ุงูุฒูู
- โ๏ธ **ููุงุญุธุฉ:** Masking ููุญููู ุงูุญุณุงุณุฉ ูููู ุชุญุณููู

### 9. ุฅุฑุณุงู ุฅุดุนุงุฑุงุช โ๏ธ
- โ๏ธ **ููููุฏ:** ุฅุดุนุงุฑ Email/SMS ูููุณุชุซูุฑ
- โ๏ธ **ุณุจุจ:** ุณูุชู ูู Epic 6 (ูุธุงู ุงูุฅุดุนุงุฑุงุช)
- โ Infrastructure ููุฌูุฏุฉ ููู ูู ูุชู ุฑุจุทูุง

### 10. ุงุณุชุฌุงุจุฉ API โ
- โ ุฅุนุงุฏุฉ ุชูุงุตูู ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ
- โ๏ธ **ููููุฏ:** ุญุงูุฉ ุงูุฏุนูุฉ ูุฑุงุจุท ุงูุชูุนูู ูู ุงูุงุณุชุฌุงุจุฉ
- โ ุงูุงุณุชุฌุงุจุฉ ุงูุญุงููุฉ ุชุญุชูู ุนูู user object ูุงูู

### 11. ุงุฎุชุจุงุฑุงุช Integration โ
- โ ุงุฎุชุจุงุฑุงุช ููุฌูุฏุฉ: `backend/tests/admin-users.controller.test.ts`
- โ ุงูุชุญูู ูู ุนุฏู ุงูุณูุงุญ ุจูุณุชุฎุฏู ููุฑุฑ (email)
- โ Transaction rollback ุนูุฏ ุงููุดู
- โ ูุฌุงุญ ุชุฏูู ุฅุฑุณุงู ุงูุฏุนูุฉ/ุงููููุฉ ุงููุคูุชุฉ

### 12. ุฌููุน ุงูุงุฎุชุจุงุฑุงุช โ
- โ Backend tests ุชูุฑ ุจูุฌุงุญ
- โ๏ธ **ููุงุญุธุฉ:** ุจุนุถ ุงูุณููุงุฑูููุงุช ูุฏ ุชุญุชุงุฌ ุชุบุทูุฉ ุฅุถุงููุฉ

---

## โ Acceptance Criteria Status

| # | Criteria | Status | Notes |
|---|---------|--------|-------|
| 1 | API endpoint POST /admin/investors | โ๏ธ | ููุฌูุฏ ูู POST /admin/users |
| 2 | ูุจูู payload ูุงูู | โ | โ๏ธ marketing_opt_in ููููุฏ |
| 3 | ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช | โ | ููุฌูุฏ |
| 4 | Supabase Admin API | โ | ููุฌูุฏ |
| 5 | ุฅูุดุงุก investor_profiles | โ | ููุฌูุฏ |
| 6 | ุฑุจุท ุฏูุฑ Investor | โ | ููุฌูุฏ |
| 7 | ุญูุธ ุงููุซุงุฆู | โ๏ธ | ุณูุชู ูู Epic 3 |
| 8 | ุชุณุฌูู Audit Logs | โ | ููุฌูุฏ |
| 9 | ุฅุฑุณุงู ุฅุดุนุงุฑุงุช | โ๏ธ | ุณูุชู ูู Epic 6 |
| 10 | ุงุณุชุฌุงุจุฉ API | โ | โ๏ธ ูููู ุชุญุณูููุง |
| 11 | ุงุฎุชุจุงุฑุงุช Integration | โ | ููุฌูุฏุฉ |
| 12 | ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุชูุฑ | โ | ููุฌูุฏุฉ |

---

## ๐ ุงููููุงุช ุงููุณุชุฎุฏูุฉ

### Backend
- โ `backend/src/services/admin-user.service.ts::createUser()` - ุงููุธููุฉ ุงูุฑุฆูุณูุฉ
- โ `backend/src/controllers/admin-user.controller.ts::createUser` - Controller
- โ `backend/src/schemas/admin-users.schema.ts` - Validation schema
- โ `backend/src/routes/admin.routes.ts` - Routes

### Frontend
- โ `frontend/src/components/admin/users/AdminInvestorCreateForm.tsx` - ูููุฐุฌ ุงูุฅูุดุงุก
- โ `frontend/src/hooks/useAdminUsers.ts::useCreateAdminUserMutation` - React Query mutation

---

## ๐ง ุงูุงุฎุชูุงูุงุช ุนู PRD

### 1. Endpoint Path
- **PRD:** `POST /admin/investors`
- **ุงููุงูุน:** `POST /admin/users` (ูุน `role: 'investor'`)
- **ุงูุณุจุจ:** ุชุตููู ููุญุฏ ูุฅูุดุงุก ุฃู ูุณุชุฎุฏู (investor ุฃู admin)

### 2. Documents Support
- **PRD:** ูุงุฆูุฉ `documents` (presigned storage keys)
- **ุงููุงูุน:** ุบูุฑ ููุฌูุฏ ุญุงููุงู
- **ุงูุณุจุจ:** ุณูุชู ุชูููุฐูุง ูู Epic 3

### 3. Notifications
- **PRD:** ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุซูุฑ
- **ุงููุงูุน:** ุบูุฑ ููุฌูุฏ ุญุงููุงู
- **ุงูุณุจุจ:** ุณูุชู ูู Epic 6

---

## โ ุงููุชูุฌุฉ

**Story 2.6 ููุชูู ุจูุณุจุฉ ~85%**

- โ ุงููุธููุฉ ุงูุฃุณุงุณูุฉ ููุฌูุฏุฉ ูุชุนูู
- โ ุฌููุน ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ ูุญููุฉ
- โ๏ธ ุจุนุถ ุงูููุฒุงุช ุงููุชูุฏูุฉ ููููุฏุฉ (documents, notifications)
- โ๏ธ Endpoint path ูุฎุชูู (ููู ููุทูู ุฃูุซุฑ)

**ุงูุชูุตูุฉ:** Story 2.6 ููุชูู ุจุดูู ูุงูู ููุงุณุชุฎุฏุงู. ุงูููุฒุงุช ุงูููููุฏุฉ ุณุชูุถุงู ูู Epics ูุงุญูุฉ (Epic 3, Epic 6).

---

## ๐ ููุงุญุธุงุช

1. **Endpoint Design:** ุงุณุชุฎุฏุงู `/admin/users` ุจุฏูุงู ูู `/admin/investors` ูู ุชุตููู ุฃูุถู ูุฃูู ููุญุฏ ููููู ุงุณุชุฎุฏุงูู ูุฅูุดุงุก ุฃู ููุน ูุณุชุฎุฏู.

2. **Future Enhancements:**
   - ุฅุถุงูุฉ `marketing_opt_in` field
   - ุชุญุณูู ุงุณุชุฌุงุจุฉ API ูุชุดูู ุญุงูุฉ ุงูุฏุนูุฉ
   - ุฑุจุท ุฅุดุนุงุฑุงุช ุนูุฏ ุงูุฅููุงู (Epic 6)
   - ุฏุนู ุฑูุน ุงููุณุชูุฏุงุช (Epic 3)

---

**ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุจูุงุณุทุฉ:** AI Assistant  
**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-01-16  
**ุงูุญุงูุฉ:** โ ููุชูู (ุชูููุฐ ุจุฏูู)

