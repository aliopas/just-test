# Story 3.9: API ุทูุจ ุดุฑุงูุฉ ูู ูุดุงุฑูุน โ ูุฑุงุฌุนุฉ ููุตูุฉ

**ุงูุชุงุฑูุฎ:** 2025-01-16  
**ุงูุญุงูุฉ:** โ ููุชูู (~95%)

---

## ๐ ูุฑุงุฌุนุฉ Acceptance Criteria

### โ AC 1: ุฅูุดุงุก API endpoint POST /investor/requests/partnership
**ุงูุญุงูุฉ:** โ **ููุชูู**  
**ุงูุชุญูู:**
- โ Route ููุฌูุฏ ูู `backend/src/routes/investor.routes.ts` (ุงูุณุทุฑ 62-66)
- โ Controller method ููุฌูุฏ ูู `backend/src/controllers/request.controller.ts` (ุงูุณุทุฑ 407-453)
- โ Endpoint: `POST /investor/requests/partnership`
- โ ูุญูู ุจู `authenticate` ู `requirePermission('investor.requests.create')`

### โ AC 2: ูุจูู payload (project_id, proposed_amount, partnership_plan, notes)
**ุงูุญุงูุฉ:** โ **ููุชูู**  
**ุงูุชุญูู:**
- โ Schema ููุฌูุฏ ูู `backend/src/schemas/request.schema.ts` (ุงูุณุทุฑ 76-91)
- โ ุงูุญููู:
  - `projectId` (ุงุฎุชูุงุฑู) - UUID
  - `proposedAmount` (ุงุฎุชูุงุฑู) - ุนุฏุฏ ููุฌุจ
  - `partnershipPlan` (ูุทููุจ) - ูุต 50-5000 ุญุฑู
  - `notes` (ุงุฎุชูุงุฑู) - ูุต ุญุชู 1000 ุญุฑู
- โ Validation ุตุญูุญ ุจุงุณุชุฎุฏุงู Zod

**ููุงุญุธุฉ:** ุชู ุงุณุชุฎุฏุงู camelCase ูู API (projectId, proposedAmount) ููุฐุง ุตุญูุญ ุญุณุจ TypeScript conventions. ุงูุจูุงูุงุช ุชูุญูุธ ูู metadata ููุง ูู ูุทููุจ.

### โ AC 3: ุญูุธ ุงูุจูุงูุงุช ูู ุญูู metadata
**ุงูุญุงูุฉ:** โ **ููุชูู**  
**ุงูุชุญูู:**
- โ Service ูุญูุธ ุงูุจูุงูุงุช ูู `metadata` (ุงูุณุทุฑ 85-89 ูู `request.service.ts`)
- โ Migration ูุถูู ุญูู `metadata` JSONB (ุงูุณุทุฑ 6 ูู migration file)
- โ ุงูุจูุงูุงุช ุงููุญููุธุฉ:
  ```json
  {
    "projectId": "...",
    "proposedAmount": 1000000,
    "partnershipPlan": "..."
  }
  ```

### โ AC 4: ุงูุชุญูู ูู ูุฌูุฏ ุงููุดุฑูุน (ุฅู ุชู ุชุญุฏูุฏู)
**ุงูุญุงูุฉ:** โ **ููุชูู**  
**ุงูุชุญูู:**
- โ Service ูุชุญูู ูู ูุฌูุฏ ุงููุดุฑูุน ูู ุฌุฏูู `projects` (ุงูุณุทุฑ 79-86)
- โ ููุฑูู ุฎุทุฃ `PROJECT_NOT_FOUND` ุฅู ูู ููุฌุฏ ุงููุดุฑูุน
- โ Controller ูุนูุฏ 404 ูุน ุฑุณุงูุฉ ูุงุถุญุฉ (ุงูุณุทุฑ 436-443)

### โ AC 5: ุงูุชุญูู ูู ุฃู ุงููุจูุบ ููุฌุจ
**ุงูุญุงูุฉ:** โ **ููุชูู**  
**ุงูุชุญูู:**
- โ Schema validation: `z.coerce.number().positive()` (ุงูุณุทุฑ 78-81)
- โ ูุชุญูู ูู ุฃู ุงููุจูุบ ููุฌุจ ูุจู ุฅูุดุงุก ุงูุทูุจ

### โ AC 6: ุฅูุดุงุก ุงูุทูุจ ุจุญุงูุฉ Draft
**ุงูุญุงูุฉ:** โ **ููุชูู**  
**ุงูุชุญูู:**
- โ Service ูููุดุฆ ุงูุทูุจ ุจุญุงูุฉ `draft` (ุงูุณุทุฑ 99)
- โ Migration ูุฏุนู ููุน `'partnership'` ูู CHECK constraint

### โ AC 7: ุชุณุฌูู ุงูุญุฏุซ ูู request_events
**ุงูุญุงูุฉ:** โ **ููุชูู**  
**ุงูุชุญูู:**
- โ Service ููุณุฌู ุญุฏุซ ุนูุฏ ุงูุฅูุดุงุก (ุงูุณุทุฑ 114-122)
- โ ุงูุญุฏุซ: `{ from_status: null, to_status: 'draft', note: 'Partnership request created' }`

### โ๏ธ AC 8: ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุชูุฑ ุจูุฌุงุญ
**ุงูุญุงูุฉ:** โ๏ธ **ุบูุฑ ููุชูู**  
**ุงูุชุญูู:**
- โ ูุง ุชูุฌุฏ unit tests ุจุนุฏ
- โ๏ธ ูุญุชุงุฌ ุฅุถุงูุฉ tests ููู controller ู service

---

## ๐ ูุฑุงุฌุนุฉ ุงูููุฏ

### Schema (`backend/src/schemas/request.schema.ts`)
**ุงูุชูููู:** โ ููุชุงุฒ

**ุงูููุงุท ุงูุฅูุฌุงุจูุฉ:**
- โ ุงุณุชุฎุฏุงู Zod ููู validation
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- โ Validation ููู (UUID, positive numbers, string lengths)
- โ Type safety ุฌูุฏ

**ุชุญุณููุงุช ูุญุชููุฉ:**
- ูุง ุชูุฌุฏ ุชุญุณููุงุช ูุทููุจุฉ ุญุงููุงู

### Service (`backend/src/services/request.service.ts`)
**ุงูุชูููู:** โ ุฌูุฏ ุฌุฏุงู

**ุงูููุงุท ุงูุฅูุฌุงุจูุฉ:**
- โ ููุทู ูุงุถุญ ูููุธู
- โ ุงูุชุญูู ูู ูุฌูุฏ ุงููุดุฑูุน
- โ ุญูุธ ุงูุจูุงูุงุช ูู metadata ุจุดูู ุตุญูุญ
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุฌูุฏุฉ
- โ ุชุณุฌูู ุงูุฃุญุฏุงุซ

**ุชุญุณููุงุช ูุญุชููุฉ:**
- โ ูุง ุชูุฌุฏ ุชุญุณููุงุช ูุทููุจุฉ ุญุงููุงู (ุชู ุฅุถุงูุฉ ุงูุชุญูู ูู ุงููุดุฑูุน)

### Controller (`backend/src/controllers/request.controller.ts`)
**ุงูุชูููู:** โ ุฌูุฏ ุฌุฏุงู

**ุงูููุงุท ุงูุฅูุฌุงุจูุฉ:**
- โ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
- โ Response codes ุตุญูุญุฉ (201, 400, 401, 404, 500)
- โ Validation ูุจู ุงุณุชุฏุนุงุก service
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ

**ุชุญุณููุงุช ูุญุชููุฉ:**
- โ ูุง ุชูุฌุฏ ุชุญุณููุงุช ูุทููุจุฉ ุญุงููุงู

### Route (`backend/src/routes/investor.routes.ts`)
**ุงูุชูููู:** โ ููุชุงุฒ

**ุงูููุงุท ุงูุฅูุฌุงุจูุฉ:**
- โ Route ูู ุงูููุงู ุงูุตุญูุญ
- โ Middleware ุตุญูุญ (authenticate + requirePermission)
- โ ุงูุชุฑุชูุจ ููุทูู (ูุจู routes ุงูุชู ุชุณุชุฎุฏู :id)

---

## ๐ ููุฎุต ุงููุฑุงุฌุนุฉ

### ุงูููุงุท ุงููููุฉ โ
1. **ุงูููุฏ ููุธู ููุงุถุญ** - ุณูููุฉ ุงููุฑุงุกุฉ ูุงูุตูุงูุฉ
2. **Validation ููู** - Zod schemas ุดุงููุฉ
3. **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** - ุชุบุทูุฉ ูุนุธู ุงูุญุงูุงุช
4. **ุงูุชูุซูู** - ุชูุฑูุฑ ุฅููุงู ููุตู
5. **ุงูุชุญูู ูู ุงููุดุฑูุน** - ุชู ุฅุถุงูุชู ุจูุฌุงุญ

### ุงูููุงุท ุงูุชู ุชุญุชุงุฌ ุชุญุณูู โ๏ธ
1. **ุงูุงุฎุชุจุงุฑุงุช** - ูุง ุชูุฌุฏ unit tests ุจุนุฏ
2. **Integration tests** - ุบูุฑ ููุฌูุฏุฉ

### ุงูููุงุท ุงูุญุฑุฌุฉ โ
**ูุง ุชูุฌุฏ** - ุงูููุฏ ุฌุงูุฒ ููุงุณุชุฎุฏุงู (ุนุฏุง ุงูุงุฎุชุจุงุฑุงุช)

---

## โ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ

**Story 3.9 ุฌุงูุฒ ุจูุณุจุฉ ~95%**

### ุงูุฎุทูุงุช ุงูุชุงููุฉ:
1. โ ุฅุถุงูุฉ unit tests (Controller + Service)
2. โ ุงุฎุชุจุงุฑ ุงูู endpoint ูุฏููุงู ุจุนุฏ ุชุทุจูู Migration
3. โ ูุฑุงุฌุนุฉ Integration ูุน ุจููุฉ ุงููุธุงู

---

## ๐ฏ Acceptance Criteria ุงูููุงุฆู

| AC | ุงูุญุงูุฉ | ุงูููุงุญุธุงุช |
|----|--------|-----------|
| 1 | โ ููุชูู | Route ู Controller ููุฌูุฏุงู |
| 2 | โ ููุชูู | Schema ุตุญูุญ ูููุชูู |
| 3 | โ ููุชูู | metadata ูุญูุธ ุจุดูู ุตุญูุญ |
| 4 | โ ููุชูู | ุงูุชุญูู ูู ุงููุดุฑูุน ููุฌูุฏ |
| 5 | โ ููุชูู | Validation ูููุจูุบ ุตุญูุญ |
| 6 | โ ููุชูู | ุงูุทูุจ ูููุดุฃ ุจุญุงูุฉ draft |
| 7 | โ ููุชูู | ุงูุฃุญุฏุงุซ ุชูุณุฌู ุจุดูู ุตุญูุญ |
| 8 | โ๏ธ TODO | ูุญุชุงุฌ unit tests |

**ุงูุฅุฌูุงูู:** 7/8 โ (87.5%)

---

**ุชู ุงููุฑุงุฌุนุฉ ุจูุงุณุทุฉ:** AI Assistant  
**ุชุงุฑูุฎ ุงููุฑุงุฌุนุฉ:** 2025-01-16

