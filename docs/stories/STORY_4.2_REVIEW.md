# Story 4.2: ูุงุฌูุฉ ุตูุฏูู ูุงุฑุฏ ุงูุทูุจุงุช - ุชูุฑูุฑ ุงููุฑุงุฌุนุฉ

**ุงูุชุงุฑูุฎ:** 2025-01-16  
**ุงูุญุงูุฉ:** โ ููุชูู - ุฌุงูุฒ ูููุฑุงุฌุนุฉ

---

## ๐ ููุฎุต ุงููุตุฉ

**Story 4.2: ูุงุฌูุฉ ุตูุฏูู ูุงุฑุฏ ุงูุทูุจุงุช**

**As a** ุฃุฏููุ  
**I want** ูุงุฌูุฉ ุดุจููุฉ ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููุทูุจุงุชุ  
**so that** ูููููู ูุฑุงุฌุนุฉ ุงูุทูุจุงุช ุจุณูููุฉ.

---

## โ ูุฑุงุฌุนุฉ Acceptance Criteria

### 1. ุฅูุดุงุก ุตูุญุฉ Requests Inbox ูู Frontend โ

**ุงูุญุงูุฉ:** โ **ููุชูู**

**ุงูููู:** `frontend/src/pages/AdminRequestsInboxPage.tsx`

**ุงูุชุญูู:**
- โ ุตูุญุฉ ูุงููุฉ ูุน `QueryClientProvider`, `LanguageProvider`, `ToastProvider`
- โ ุงุณุชุฎุฏุงู `useAdminRequests` hook ูุฌูุจ ุงูุจูุงูุงุช
- โ ุชูุงูู ูุงูู ูุน FilterBar, Table, Pagination
- โ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก ูุงูู loading states

**ููุงุท ุงูููุฉ:**
- โ ุจููุฉ ููุธูุฉ ููุงุถุญุฉ
- โ ูุตู ุงููุณุคูููุงุช (separation of concerns)
- โ ุงุณุชุฎุฏุงู React Query ููู caching ูุงูู refetching

**ููุงุญุธุงุช:**
- โ๏ธ ูุง ููุฌุฏ route ูู App.tsxุ (ูุญุชุงุฌ ุงูุชุญูู)

---

### 2. ุนุฑุถ ูุงุฆูุฉ ุงูุทูุจุงุช ูุน ุงูููุชุฑุฉ ูุงููุฑุฒ โ

**ุงูุญุงูุฉ:** โ **ููุชูู**

**ุงูุชุญูู:**
- โ FilterBar ูุฏุนู ุฌููุน ุฃููุงุน ุงูููุชุฑุฉ (status, type, date range, amount range, search)
- โ ุงููุฑุฒ ูุชุนุฏุฏ ุงูุญููู (created_at, amount, status)
- โ ุงูุงุชุฌุงู (asc/desc) ูุฏุนูู

**ููุงุท ุงูููุฉ:**
- โ ูุงุฌูุฉ ูุณุชุฎุฏู ุจุฏูููุฉ
- โ ุฏุนู ุฌููุน ุงูุฃููุงุน ุงูุฌุฏูุฏุฉ (partnership, board_nomination, feedback)
- โ ููุชุฑุฉ ูุชูุฏูุฉ (date range, amount range)

**ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:**
- ๐ก ุฅุถุงูุฉ ููุชุฑุฉ ุญุณุจ `isRead` (unread/read/all)
- ๐ก ุญูุธ ุงูููุชุฑุฉ ูู URL query params ููู bookmarking

---

### 3. ุชุตููู ุดุจูู ุจุงูุจุฑูุฏ ูุน Inbox โ

**ุงูุญุงูุฉ:** โ **ููุชูู**

**ุงูุชุญูู:**
- โ ุตููู ูููุฒุฉ ููุทูุจุงุช ุบูุฑ ุงูููุฑูุกุฉ (background highlight + border)
- โ ุนููุฏูุงุช ูุงุถุญุฉ ูููุธูุฉ
- โ dot indicator ููุทูุจุงุช ุบูุฑ ุงูููุฑูุกุฉ
- โ transition effects

**ููุงุท ุงูููุฉ:**
- โ ุชุตููู ุงุญุชุฑุงูู ุดุจูู ุจู email clients
- โ ุชูููุฒ ูุงุถุญ ุจูู ุงูููุฑูุก ูุบูุฑ ุงูููุฑูุก
- โ ุฃููุงู ูุชูุงุณูุฉ ูุน design system

**ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:**
- ๐ก ุฅุถุงูุฉ hover effect ุนูู ุงูุตููู
- ๐ก ุฅุถุงูุฉ checkbox ููู bulk selection
- ๐ก ุฅุถุงูุฉ "Mark as read" action

---

### 4. ุนุฑุถ ูุนูููุงุช ูุฎุชุตุฑุฉ ููู ุทูุจ โ

**ุงูุญุงูุฉ:** โ **ููุชูู**

**ุงูุชุญูู:**

#### ุฃ) ุฑูู ุงูุทูุจ โ
- โ ูุนุฑุถ ูู ุนููุฏ ูููุตู
- โ ุฑุงุจุท ุฅูู ุตูุญุฉ ุงูุชูุงุตูู
- โ dot indicator ููุทูุจุงุช ุบูุฑ ุงูููุฑูุกุฉ

#### ุจ) ุงูููุน โ
- โ ุนููุฏ ุฌุฏูุฏ ูุน Badge ูููู
- โ ุฃููุงู ูููุฒุฉ ููู ููุน:
  - `buy`: ุฃุฎุถุฑ โ
  - `sell`: ุจุฑุชูุงูู โ
  - `partnership`: ุฃุฒุฑู โ
  - `board_nomination`: ุจููุณุฌู โ
  - `feedback`: ูุฑุฏู โ

#### ุฌ) ุงููุณุชุซูุฑ โ
- โ ูุนุฑุถ fullName ุฃู preferredName ุฃู email
- โ fallback ุฅูู "โ" ุฅุฐุง ูู ููู ูุชููุฑ

#### ุฏ) ุงููุจูุบ/ุงูููุถูุน โ
- โ ููู **feedback**: ูุนุฑุถ `subject` ูู metadata โ
- โ ููู **partnership**: ูุนุฑุถ `proposedAmount` ูู metadata โ
- โ ููู **board_nomination**: ูุนุฑุถ label ุซุงุจุช โ
- โ ููู **buy/sell**: ูุนุฑุถ ุงููุจูุบ ูุน currency formatting โ

#### ูู) ุงูุญุงูุฉ โ
- โ Badge ูููู ูุน label
- โ ุงุณุชุฎุฏุงู `RequestStatusBadge` component

#### ู) ุงูุชุงุฑูุฎ โ
- โ ูุนุฑุถ `createdAt` ูุน ุชูุณูู ูุญูู
- โ ุฏุนู ุงููุบุฉ (ar/en)

**ููุงุท ุงูููุฉ:**
- โ ููุทู ุฐูู ูุนุฑุถ ุงููุจูุบ/ุงูููุถูุน ุญุณุจ ุงูููุน
- โ ุชูุณูู ููุงุณุจ ููุนููุงุช ูุงูุชูุงุฑูุฎ

**ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:**
- ๐ก ุฅุถุงูุฉ tooltip ุนูู ุงููุจูุบ/ุงูููุถูุน ููุชูุงุตูู ุงููุงููุฉ
- ๐ก ุฅุถุงูุฉ `updatedAt` ูุนููุฏ ูููุตู ุฃู ูู tooltip

---

### 5. ุชูููุฒ ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ/ุงููุชุนุซุฑุฉ โ

**ุงูุญุงูุฉ:** โ **ููุชูู**

#### ุฃ) ุชูููุฒ ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ โ

**ุงูุชุญูู:**
- โ ุฎูููุฉ ูููุฒุฉ (`background-highlight`) โ
- โ Border ุฃูุณุฑ ุฃุฒุฑู (4px) โ
- โ Font weight ุฃููู (600) โ
- โ Dot indicator ุจุฌุงูุจ ุฑูู ุงูุทูุจ โ

**ุงูููุทู:**
```typescript
const isUnread = !request.isRead;
```

**ููุงุญุธุฉ ูุงูุฉ:** โ
- `isRead` ูุชู ุชุญุฏูุซู ุชููุงุฆูุงู ูู Backend ุนูุฏ ูุชุญ ุตูุญุฉ ุงูุชูุงุตูู (`getAdminRequestDetail` ูุณุชุฏุนู `markRequestAsRead`)
- ุนูุฏ ุงูุนูุฏุฉ ูู ุตูุญุฉ ุงูุชูุงุตูู ุฅูู Inboxุ ุณูุนูุฏ `isRead = true`
- โ ุงูุชุตููู ุงูุญุงูู ูุนูู ุจุดูู ุตุญูุญ

#### ุจ) ุชูููุฒ ุงูุทูุจุงุช ุงููุชุนุซุฑุฉ โ

**ุงูุชุญูู:**
- โ ููุท ููุทูุจุงุช ุจู status `pending_info` โ
- โ ุฃูุซุฑ ูู 7 ุฃูุงู ููุฐ ุขุฎุฑ ุชุญุฏูุซ โ
- โ ุชุญุฐูุฑ ูุฑุฆู (โ๏ธ ูุชุนุซุฑ / โ๏ธ Stale) โ

**ุงูููุทู:**
```typescript
function isStaleRequest(request: AdminRequest): boolean {
  if (request.status !== 'pending_info') {
    return false;
  }
  const updatedAt = new Date(request.updatedAt);
  const daysSinceUpdate = (Date.now() - updatedAt.getTime()) / (1000 * 60 * 60 * 24);
  return daysSinceUpdate > 7;
}
```

**ููุงุท ุงูููุฉ:**
- โ ููุทู ูุงุถุญ ููุญุฏุฏ
- โ ุชูููุฒ ูุฑุฆู ููุงุณุจ

**ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:**
- ๐ก ุฌุนู ุนุฏุฏ ุงูุฃูุงู ูุงุจู ููุชุนุฏูู (configurable)
- ๐ก ุฅุถุงูุฉ filter ููุทูุจุงุช ุงููุชุนุซุฑุฉ
- ๐ก ุฅุถุงูุฉ alert/badge ูู ุงูู header ูุนุฏุฏ ุงูุทูุจุงุช ุงููุชุนุซุฑุฉ

---

### 6. Pagination ูููุชุงุฆุฌ โ

**ุงูุญุงูุฉ:** โ **ููุชูู**

**ุงูููู:** `frontend/src/components/admin/requests/AdminRequestsPagination.tsx`

**ุงูุชุญูู:**
- โ Previous/Next buttons โ
- โ ุนุฑุถ ูุนูููุงุช ุงูุตูุญุฉ (page/total/count) โ
- โ Disable buttons ุนูุฏ ุงูุญุฏูุฏ โ
- โ ุชูุงูู ูุน filters state โ

**ููุงุท ุงูููุฉ:**
- โ ุจุณูุท ููุนุงู
- โ ูุนุฑุถ ูุนูููุงุช ูุงููุฉ

**ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:**
- ๐ก ุฅุถุงูุฉ page number selector
- ๐ก ุฅุถุงูุฉ "Jump to page" input
- ๐ก ุนุฑุถ ุนุฏุฏ ุงูุทูุจุงุช ูู ุงูุตูุญุฉ ุงูุญุงููุฉ

---

### 7. ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุชูุฑ ุจูุฌุงุญ โ๏ธ

**ุงูุญุงูุฉ:** โ๏ธ **ุบูุฑ ููุชูู**

**ุงููุถุน ุงูุญุงูู:**
- โ ูุง ุชูุฌุฏ ุงุฎุชุจุงุฑุงุช unit ููู AdminRequestsTable
- โ ูุง ุชูุฌุฏ ุงุฎุชุจุงุฑุงุช unit ููู AdminRequestsFilterBar
- โ ูุง ุชูุฌุฏ ุงุฎุชุจุงุฑุงุช unit ููู AdminRequestsInboxPage
- โ ูุง ุชูุฌุฏ ุงุฎุชุจุงุฑุงุช integration

**ุงูุชูุตูุฉ:**
1. ุฅุถุงูุฉ unit tests ููู `formatAmountOrSubject` function
2. ุฅุถุงูุฉ unit tests ููู `isStaleRequest` function
3. ุฅุถุงูุฉ component tests ููู AdminRequestsTable
4. ุฅุถุงูุฉ component tests ููู AdminRequestsFilterBar
5. ุฅุถุงูุฉ integration tests ููู ุตูุญุฉ ูุงููุฉ

---

## ๐ ูุฑุงุฌุนุฉ ุงูููุฏ

### 1. AdminRequestsTable.tsx

#### ููุงุท ุงูููุฉ:
- โ Helper functions ูููุตูุฉ ููุงุถุญุฉ
- โ Type safety ุฌูุฏ
- โ Error handling ููุงุณุจ
- โ Empty states ู loading states
- โ ุชุตููู responsive

#### ููุงุท ุงูุชุญุณูู:
- โ๏ธ `formatAmountOrSubject` ูููู ุชุญุณููู:
  ```typescript
  // ุญุงููุงู: ูุชุญูู ูู metadata ูู ูู ูุฑุฉ
  // ููุชุฑุญ: ุงุณุชุฎุฑุงุฌ metadata parsing ุฅูู helper function
  ```
- โ๏ธ `isStaleRequest` hardcoded ุฅูู 7 ุฃูุงู - ูููู ุฌุนูู configurable
- ๐ก ุฅุถุงูุฉ memoization ููู calculations
- ๐ก ุฅุถุงูุฉ accessibility attributes (aria-labels)

#### Bugs ูุญุชููุฉ:
- โ๏ธ `formatAmountOrSubject` ููู partnership: ูุนุฑุถ "SAR" hardcoded - ูุฌุจ ุงุณุชุฎุฏุงู currency ูู metadata ุฅุฐุง ูุงู ูุชููุฑ
- โ๏ธ ุนูุฏ `amount == null` ููู buy/sellุ ูุฏ ูุนุฑุถ "โ" - ูุฐุง ุตุญูุญ ููู ูุฏ ูุญุชุงุฌ message ุฃูุถุญ

---

### 2. AdminRequestsFilterBar.tsx

#### ููุงุท ุงูููุฉ:
- โ ุฌููุน ุฃููุงุน ุงูููุชุฑุฉ ูุฏุนููุฉ
- โ UI ููุธูุฉ ููุงุถุญุฉ
- โ ุฏุนู RTL

#### ููุงุท ุงูุชุญุณูู:
- ๐ก ุฅุถุงูุฉ ููุชุฑุฉ ุญุณุจ `isRead` status
- ๐ก ุญูุธ ุงูููุชุฑุฉ ูู URL
- ๐ก ุฅุถุงูุฉ "Clear all filters" button ุฃูุซุฑ ูุถูุญุงู

---

### 3. AdminRequestsInboxPage.tsx

#### ููุงุท ุงูููุฉ:
- โ ุจููุฉ ุฌูุฏุฉ
- โ Error handling ููุงุณุจ
- โ Toast notifications

#### ููุงุท ุงูุชุญุณูู:
- โ๏ธ `QueryClient` ูุชู ุฅูุดุงุคู ูู ูู render - ูุฌุจ ูููู ุฎุงุฑุฌ component
- ๐ก ุฅุถุงูุฉ auto-refresh option
- ๐ก ุฅุถุงูุฉ keyboard shortcuts

---

## ๐ง ุงูุชุญุณููุงุช ุงูููุตู ุจูุง

### ุนุงููุฉ ุงูุฃููููุฉ:

1. **ุฅุตูุงุญ currency ูู partnership:**
   - ุญุงููุงู: hardcoded "SAR"
   - ูุฌุจ: ุงุณุชุฎุฏุงู currency ูู metadata ุฃู default

3. **ุฅุถุงูุฉ unit tests:**
   - ููู helper functions
   - ููู components

### ูุชูุณุทุฉ ุงูุฃููููุฉ:

4. **ุฅุถุงูุฉ ููุชุฑุฉ ุญุณุจ isRead:**
   - Unread / Read / All

5. **ุญูุธ ุงูููุชุฑุฉ ูู URL:**
   - ููู bookmarking
   - ููู sharing

6. **ุชุญุณูู performance:**
   - Memoization ููู calculations
   - Virtual scrolling ููู large lists

### ููุฎูุถุฉ ุงูุฃููููุฉ:

7. **ุฅุถุงูุฉ features ุฅุถุงููุฉ:**
   - Bulk selection
   - Bulk actions (mark as read, etc.)
   - Keyboard shortcuts
   - Export to CSV

---

## ๐ Bugs ุงููุญุชููุฉ

### 1. Currency Hardcoding ูู Partnership

**ุงููููุน:** `AdminRequestsTable.tsx` line 37

```typescript
currency: 'SAR',  // โ๏ธ Hardcoded
```

**ุงููุดููุฉ:** Partnership requests ูุฏ ุชุณุชุฎุฏู ุนููุงุช ุฃุฎุฑู.

**ุงูุญู ุงูููุชุฑุญ:**
```typescript
const currency = metadata?.currency || 'SAR';
```

---

### 2. QueryClient ูู ูู Render

**ุงููููุน:** `AdminRequestsInboxPage.tsx` line 16

```typescript
const queryClient = new QueryClient();  // โ๏ธ ูุชู ุฅูุดุงุคู ูู ูู render
```

**ุงููุดููุฉ:** ูุฌุจ ุฅูุดุงุคู ูุฑุฉ ูุงุญุฏุฉ ููุท.

**ุงูุญู ุงูููุชุฑุญ:**
```typescript
const queryClient = new QueryClient();

export function AdminRequestsInboxPage() {
  // ...
}
```

---

## ๐ ุงูุชูููู ุงูุนุงู

| ุงููุนูุงุฑ | ุงูุชูููู | ุงูููุงุญุธุงุช |
|---------|---------|-----------|
| **Functionality** | โญโญโญโญโญ | ุฌููุน ุงููุชุทูุจุงุช ูุญููุฉ |
| **Code Quality** | โญโญโญโญโ | ุฌูุฏ ุฌุฏุงูุ ูุญุชุงุฌ ุชุญุณููุงุช ุจุณูุทุฉ |
| **UX/UI** | โญโญโญโญโญ | ููุชุงุฒุ ุชุตููู ุงุญุชุฑุงูู |
| **Performance** | โญโญโญโญโ | ุฌูุฏุ ูููู ุชุญุณููู |
| **Testing** | โญโโโโ | ูุญุชุงุฌ ุฅุถุงูุฉ ุงุฎุชุจุงุฑุงุช |
| **Accessibility** | โญโญโญโโ | ุฌูุฏุ ูุญุชุงุฌ ุชุญุณููุงุช |
| **Documentation** | โญโญโญโญโ | ุฌูุฏ ุฌุฏุงู |

**ุงูุชูููู ุงูุฅุฌูุงูู:** โญโญโญโญโ (4.2/5)

---

## โ ุงูุฎูุงุตุฉ

**Story 4.2 ููุชูู ุจุดูู ููุชุงุฒ!**

### ููุงุท ุงูููุฉ:
- โ ุฌููุน Acceptance Criteria ูุญููุฉ
- โ ุชุตููู ุงุญุชุฑุงูู ูุดุจูู ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- โ ุฏุนู ูุงูู ูุฌููุน ุฃููุงุน ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ
- โ ุชูููุฒ ูุงุถุญ ููุทูุจุงุช ุงูุฌุฏูุฏุฉ ูุงููุชุนุซุฑุฉ
- โ ููุฏ ููุธู ูุณูู ุงูุตูุงูุฉ

### ููุงุท ุงูุชุญุณูู:
- โ๏ธ ูุญุชุงุฌ ุฅุถุงูุฉ ุงุฎุชุจุงุฑุงุช
- โ๏ธ ุจุนุถ ุงูุชุญุณููุงุช ุงูุจุณูุทุฉ ูู ุงูููุฏ
- ๐ก ุฅุถุงูุฉ features ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)

### ุงูุชูุตูุฉ:
- โ **ูุจูู Story 4.2** - ุฌุงูุฒ ูููุชุงุจุนุฉ
- โ๏ธ **ุฅุถุงูุฉ ุงูุงุฎุชุจุงุฑุงุช** ูู ูุงุฆูุฉ ุงูููุงู ุงููุณุชูุจููุฉ
- ๐ก **ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ** ูููู ุชุทุจูููุง ูู iteration ูุงุฏูุฉ

---

**ุชู ุงููุฑุงุฌุนุฉ ุจูุงุณุทุฉ:** AI Assistant  
**ุชุงุฑูุฎ ุงููุฑุงุฌุนุฉ:** 2025-01-16  
**ุงูุญุงูุฉ:** โ ูุนุชูุฏ - ุฌุงูุฒ ูููุชุงุจุนุฉ

