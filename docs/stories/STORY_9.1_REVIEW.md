# Story 9.1: ูุฑุงุฌุนุฉ ุฅูุดุงุก ุฌุฏุงูู ุงููุญุชูู ุงูุนุงู

**ุชุงุฑูุฎ ุงููุฑุงุฌุนุฉ:** 2025-01-17  
**ุงูุญุงูุฉ:** โ ููุชูู ูุน ููุงุญุธุงุช

---

## ๐ ููุฎุต ุงููุฑุงุฌุนุฉ

ุชู ูุฑุงุฌุนุฉ Story 9.1 ุจุดูู ุดุงูู. ุงููุตุฉ ููุชููุฉ ุจุดูู ุฌูุฏ ูุน ุจุนุถ ุงูููุงุญุธุงุช ุงูุจุณูุทุฉ.

---

## โ ูุง ุชู ุฅูุฌุงุฒู ุจุดูู ุตุญูุญ

### 1. ุงูุฌุฏุงูู ุงูุซูุงููุฉ โ
ุชู ุฅูุดุงุก ุฌููุน ุงูุฌุฏุงูู ุงููุทููุจุฉ:
- โ `company_profile`
- โ `company_partners`
- โ `company_clients`
- โ `company_resources`
- โ `company_strengths`
- โ `partnership_info`
- โ `market_value`
- โ `company_goals`

### 2. ุจููุฉ ุงูุฌุฏุงูู โ
ุฌููุน ุงูุฌุฏุงูู ุชุญุชูู ุนูู ุงูุญููู ุงููุทููุจุฉ ุญุณุจ PRD:
- โ ุฌููุน ุงูุญููู ุงูุฃุณุงุณูุฉ ููุฌูุฏุฉ
- โ ุฏุนู ุซูุงุฆู ุงููุบุฉ (ar/en) โ
- โ ุญููู `display_order` ููุชุฑุชูุจ โ
- โ ุญููู `created_at` ู `updated_at` โ
- โ ุญููู ุฎุงุตุฉ ูุซู `is_active`, `is_verified` โ

### 3. Indexes โ
ุชู ุฅูุดุงุก indexes ูุญุณููุฉ:
- โ Index ุนูู `display_order` ูุฌููุน ุงูุฌุฏุงูู
- โ Index ุนูู `is_active` ูุฌุฏูู `company_profile`
- โ Index ุนูู `valuation_date DESC` ูุฌุฏูู `market_value`
- โ Index ุนูู `is_verified` ูุฌุฏูู `market_value`
- โ Index ุนูู `target_date` ูุฌุฏูู `company_goals`

### 4. Triggers โ
ุชู ุฅูุดุงุก triggers ูุฌููุน ุงูุฌุฏุงูู:
- โ ุฌููุน triggers ุชุณุชุฎุฏู function `update_updated_at_column()` ุงูููุฌูุฏุฉ
- โ 8 triggers ุชู ุฅูุดุงุคูุง ุจุดูู ุตุญูุญ

### 5. RLS Policies โ
ุชู ุชูุนูู RLS ูุฅูุดุงุก policies:
- โ RLS ููุนูู ุนูู ุฌููุน ุงูุฌุฏุงูู
- โ Policies ูููุฑุงุกุฉ ุงูุนุงูุฉ ุญุณุจ ุงููุชุทูุจุงุช:
  - `company_profile`: ููุท ุงููุญุชูู ุงููุดุท (`is_active = TRUE`)
  - `market_value`: ููุท ุงููุญุชูู ุงูููุชุญูู ููู (`is_verified = TRUE`)
  - ุจุงูู ุงูุฌุฏุงูู: ูุฑุงุกุฉ ุนุงูุฉ ููุฌููุน

### 6. Service Layer โ
ุชู ุฅูุดุงุก service layer ูุงูู:
- โ ุฌููุน ุฏูุงู CRUD ููุฌูุฏุฉ (Create, Read, Update, Delete)
- โ Type definitions ูุงุถุญุฉ ูููุธูุฉ
- โ Mapping functions ุจูู database rows ู TypeScript types
- โ Error handling ููุงุณุจ

### 7. Schema Validation โ
ุชู ุฅูุดุงุก validation schemas:
- โ Zod schemas ูุฌููุน ุงูุฌุฏุงูู
- โ Create ู Update schemas ูููุตูุฉ
- โ Validation rules ููุงุณุจุฉ (min/max length, required fields, etc.)

---

## โ๏ธ ุงูููุงุญุธุงุช ูุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ

### 1. Foreign Keys ูุงูุนูุงูุงุช โ๏ธ
**ุงูููุงุญุธุฉ:** ุญุณุจ PRDุ ุงููุชุทูุจ 11 ูุชุทูุจ "ุฅุนุฏุงุฏ Foreign Keys ูุงูุนูุงูุงุช". ููู ูู migration ุงูุญุงูู ูุง ุชูุฌุฏ foreign keys.

**ุงูุชูููู:**
- โ ุงูุฌุฏุงูู ุงูุซูุงููุฉ ูุณุชููุฉ ููุง ุชุญุชุงุฌ foreign keys ูููุง ุจูููุง
- โ ูุง ุชูุฌุฏ ุนูุงูุงุช ูุทููุจุฉ ุญุณุจ ุงูุชุตููู
- โ๏ธ **ููุงุญุธุฉ:** ูููู ุฅุถุงูุฉ foreign key ูุงุญูุงู ุฅุฐุง ุงุญุชุฌูุง ุฑุจุท ุฃู ุฌุฏูู ุจุฌุฏูู `users` (ูุซู `created_by`)

**ุงูุชูุตูุฉ:** โ **ูุง ููุฌุฏ ุฅุฌุฑุงุก ูุทููุจ** - ุงูุชุตููู ุงูุญุงูู ุตุญูุญ

### 2. Function `update_updated_at_column()` โ
**ุงูุชุญูู:** Function ููุฌูุฏุฉ ูู migration ุงูุฃูููุฉ (`20241106000000_initial_core.sql`)

**ุงูุชูููู:** โ **ุตุญูุญ** - Triggers ุชุณุชุฎุฏู function ููุฌูุฏุฉ ูุณุจูุงู

### 3. Service Layer - ุงุณุชุฎุฏุงู `requireSupabaseAdmin()` โ๏ธ
**ุงูููุงุญุธุฉ:** ุฌููุน ุงูุฏูุงู ูู service ุชุณุชุฎุฏู `requireSupabaseAdmin()`.

**ุงูุชูููู:**
- โ ุตุญูุญ ููุนูููุงุช ุงูุฅุฏุงุฑูุฉ (Create, Update, Delete)
- โ๏ธ **ููุงุญุธุฉ:** ุฏูุงู ุงููุฑุงุกุฉ ุงูุนุงูุฉ (Public endpoints) ูุฌุจ ุฃู ุชุณุชุฎุฏู client ุนุงุฏู ูููุณ admin client

**ุงูุชูุตูุฉ:** 
- โ **Story 9.1 ุตุญูุญ** - Service layer ููุนูููุงุช ุงูุฅุฏุงุฑูุฉ
- ๐ **ููุงุญุธุฉ ูู Story 9.2:** ุนูุฏ ุฅูุดุงุก public endpointsุ ูุฌุจ ุฅูุดุงุก ุฏูุงู ูููุตูุฉ ุชุณุชุฎุฏู client ุนุงุฏู

### 4. Error Handling โ
**ุงูุชุญูู:** ุฌููุน ุงูุฏูุงู ุชุญุชูู ุนูู error handling ููุงุณุจ

**ุงูุชูููู:** โ **ุฌูุฏ** - Error messages ูุงุถุญุฉ ููููุฏุฉ

### 5. Type Safety โ
**ุงูุชุญูู:** ุฌููุน Types ู Interfaces ูุญุฏุฏุฉ ุจุดูู ุตุญูุญ

**ุงูุชูููู:** โ **ููุชุงุฒ** - Type safety ููู ูุน TypeScript

### 6. Migration Safety โ (ุชู ุงูุชุญุณูู)
**ุงูุชุญูู:** Migration ูุญุณููุฉ ูุชุฌูุจ ุงูุฃุฎุทุงุก ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู

**ุงูุชุญุณููุงุช:**
- โ Triggers ุชุณุชุฎุฏู DO blocks ูุน IF NOT EXISTS
- โ RLS Policies ุชุณุชุฎุฏู DROP POLICY IF EXISTS ูุจู CREATE

**ุงูุชูููู:** โ **ููุชุงุฒ** - Migration ุขููุฉ ููุงุจูุฉ ูุฅุนุงุฏุฉ ุงูุชุดุบูู

---

## ๐ ููุงุฑูุฉ ูุน Acceptance Criteria

| # | Criteria | Status | Notes |
|---|----------|--------|-------|
| 1 | ุฅูุดุงุก 8 ุฌุฏุงูู | โ | ุฌููุน ุงูุฌุฏุงูู ููุฌูุฏุฉ |
| 2 | ุฌุฏูู `company_profile` | โ | ุฌููุน ุงูุญููู ููุฌูุฏุฉ |
| 3 | ุฌุฏูู `company_partners` | โ | ุฌููุน ุงูุญููู ููุฌูุฏุฉ |
| 4 | ุฌุฏูู `company_clients` | โ | ุฌููุน ุงูุญููู ููุฌูุฏุฉ |
| 5 | ุฌุฏูู `company_resources` | โ | ุฌููุน ุงูุญููู ููุฌูุฏุฉ |
| 6 | ุฌุฏูู `company_strengths` | โ | ุฌููุน ุงูุญููู ููุฌูุฏุฉ |
| 7 | ุฌุฏูู `partnership_info` | โ | ุฌููุน ุงูุญููู ููุฌูุฏุฉ (ุจูุง ูู ุฐูู JSONB) |
| 8 | ุฌุฏูู `market_value` | โ | ุฌููุน ุงูุญููู ููุฌูุฏุฉ |
| 9 | ุฌุฏูู `company_goals` | โ | ุฌููุน ุงูุญููู ููุฌูุฏุฉ |
| 10 | ุฅูุดุงุก indexes | โ | ุฌููุน indexes ููุฌูุฏุฉ |
| 11 | ุฅุนุฏุงุฏ Foreign Keys | โ๏ธ | ุบูุฑ ูุทููุจ ุญุณุจ ุงูุชุตููู |
| 12 | RLS Policies | โ | ุฌููุน policies ููุฌูุฏุฉ |
| 13 | ุฌููุน ุงูุงุฎุชุจุงุฑุงุช | โณ | ุณูุชู ูู Story 9.2 |

---

## ๐ ูุญุต ุงูููุฏ

### Migration File โ
- โ SQL syntax ุตุญูุญ
- โ ุฌููุน ุงูุฌุฏุงูู ูุญุฏุฏุฉ ุจุดูู ุตุญูุญ
- โ Indexes ูุญุณููุฉ
- โ Triggers ุตุญูุญุฉ
- โ RLS policies ููุงุณุจุฉ

### Service File โ
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก linter
- โ Code structure ููุธู
- โ Type safety ููู
- โ Error handling ููุงุณุจ

### Schema File โ
- โ Zod validation schemas ุตุญูุญุฉ
- โ Validation rules ููุงุณุจุฉ
- โ Type exports ุตุญูุญุฉ

---

## โ ุงูุฎูุงุตุฉ

**Story 9.1 ููุชูู ุจูุฌุงุญ** โ

### ุงูููุงุท ุงูุฅูุฌุงุจูุฉ:
1. โ ุฌููุน ุงูุฌุฏุงูู ุชู ุฅูุดุงุคูุง ุจุดูู ุตุญูุญ
2. โ Indexes ูุญุณููุฉ ููุฃุฏุงุก
3. โ RLS policies ููุงุณุจุฉ ููุฃูุงู
4. โ Service layer ูุงูู ูููุธู
5. โ Schema validation ููู
6. โ Type safety ููุชุงุฒ

### ุงูููุงุญุธุงุช:
1. โ๏ธ Foreign Keys ุบูุฑ ูุทููุจุฉ ุญุณุจ ุงูุชุตููู ุงูุญุงูู (ุตุญูุญ)
2. โ Migration ูุญุณููุฉ ุจุฅุถุงูุฉ DO blocks ููู triggers ู DROP IF EXISTS ููู policies
3. ๐ ููุงุญุธุฉ ูู Story 9.2: ุฅูุดุงุก public endpoints ูููุตูุฉ

### ุงูุชูุตูุงุช:
- โ **Story 9.1 ุฌุงูุฒ ูููุชุงุจุนุฉ**
- ๐ **Story 9.2:** ุฅูุดุงุก API endpoints (Admin + Public)
- ๐ **Story 9.2:** ุฅุถุงูุฉ tests ููุฎุฏูุงุช

---

## ๐ ุงููููุงุช ุงููุฑุงุฌุนุฉ

1. โ `supabase/migrations/20250117000000_company_content_tables.sql`
2. โ `backend/src/services/company-content.service.ts`
3. โ `backend/src/schemas/company-content.schema.ts`
4. โ `docs/stories/STORY_9.1_COMPLETION.md`

---

**ุชูุช ุงููุฑุงุฌุนุฉ ุจูุงุณุทุฉ:** AI Assistant  
**ุชุงุฑูุฎ ุงููุฑุงุฌุนุฉ:** 2025-01-17  
**ุชุงุฑูุฎ ุงูุชุญุณูู:** 2025-01-17  
**ุงูุญุงูุฉ:** โ Story 9.1 ููุชูู ููุญุณูู ูููุจูู

---

## ๐ ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. ุชุญุณูู Triggers โ
- ุชู ุฅุถุงูุฉ DO blocks ููุชุญูู ูู ูุฌูุฏ triggers ูุจู ุฅูุดุงุฆูุง
- Migration ุงูุขู ุขููุฉ ูุฅุนุงุฏุฉ ุงูุชุดุบูู ุจุฏูู ุฃุฎุทุงุก

### 2. ุชุญุณูู RLS Policies โ
- ุชู ุฅุถุงูุฉ DROP POLICY IF EXISTS ูุจู CREATE
- Policies ุงูุขู ูุงุจูุฉ ููุชุญุฏูุซ ุจุฏูู ุฃุฎุทุงุก

