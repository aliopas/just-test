## تحديثات 11 نوفمبر 2025

- إضافة صفحة `AdminInvestorsPage` ودمجها في شريط التنقل الإداري لإتاحة إنشاء مستثمرين جدد ومتابعة حساباتهم.
- إنشاء مكونات دعم لواجهة الإدارة (`AdminInvestorCreateForm`, `AdminUsersTable`, `AdminUsersFilterBar`, `AdminUsersPagination`) وربطها مع مصدر البيانات عبر `useAdminUsers`.
- تعريف هيكل بيانات جديد للمستثمرين الإداريين (`admin-users.ts`) مع رسائل ترجمة (`adminUsers.ts`) لدعم اللغتين العربية والإنجليزية.
- ضبط تهيئة النموذج والتحقق باستخدام `zod` لضمان التوافق مع متطلبات الـ backend واستدعاء Mutation الإنشاء.
- معالجة أخطاء البناء الخلفي بتوسيع Typings لخدمة `rbac.service` لاستيعاب أشكال العلاقات المختلفة واسترجاع معرفات الأدوار قبل تحميل صلاحيات fallback.
- توثيق عملية البناء الناجح (`npm run build`) بعد الإصلاحات للتأكد من جاهزية النشر على Netlify.
- تعديل hook `useInvestorProfile` بحيث يعيد `null` عند استجابة 404 ليعرض حالة الملف الفارغ للمستثمر بدلاً من إظهار خطأ.
- تحسين `AuthProvider` للتحقق من وجود توكنات Supabase قبل إعادة إحياء المستخدم، وإضافة مستمع تركيز للمتصفح لتحديث حالة المصادقة ومنع طلبات 401 المتكررة.

## تحديثات 12 نوفمبر 2025

- إنشاء صفحة `InvestorStocksPage` لتمكين المستثمرين من متابعة أداء سهم باكورة مع عرض sparkline، متوسطات متحركة، نطاقات تداول، وحجم التداول لآخر 30 يومًا بدعم كامل للـ RTL.
- إضافة hook جديد `useInvestorStockFeed` وأنواع `stocks.ts` لاستهلاك واجهة `/investor/stocks` وتخزين البيانات مؤقتًا عبر TanStack Query مع تحديثات دورية.
- تطوير خدمة `getBacuraStockFeed` ومتحكم `investor-stocks.controller` في الـ backend لتجميع مؤشرات الأداء (التذبذب، الاتجاه، أفضل/أضعف يوم) من جدول Supabase الجديد.
- ترحيل قاعدة البيانات بإنشاء جدول `bacura_stock_snapshots`، وسياسة RLS، وتهيئة بيانات تاريخية لمدة 60 يومًا، بالإضافة إلى ترخيص صلاحية `investor.market.read` وربطها بدور المستثمر.
- إدراج مسار `/investor/stocks` في `investor.routes.ts` مع متطلبات صلاحيات محدثة وضمان المصادقة.
- تحديث `App.tsx` لإضافة رابط "Bacura stock" في شريط تنقل المستثمرين، وربط الصفحة الجديدة ضمن المسارات المحمية.
- دمج صفحة `AdminSignupRequestsPage` في شريط التنقل الإداري ومسارات الـ router لتمكين مراجعة طلبات التسجيل الجديدة، مع توفير ترجمات خاصة بالصفحة (`adminSignupRequests.ts`) وhook البيانات (`useAdminAccountRequests`).
### تحسينات 12 نوفمبر 2025

- توسيع ماكينة حالات الطلب في `request-state.service` للسماح بانتقالات مباشرة من حالات `draft` و`submitted` و`pending_info` إلى مراحل الفحص والمراجعة والموافقة دون رمي أخطاء 409.
- إضافة خدمة `moveAdminRequestToStatus` ومسار REST جديد `PATCH /admin/requests/:id/status` مع واجهة مستخدم (أزرار "نقل إلى التصفية" و"نقل إلى مراجعة الالتزام") داخل صفحة تفاصيل الطلب الإداري، ما مكّن فريق المراجعة من تحريك الطلب قبل الموافقة/الرفض.
- إصلاح روابط جدول الطلبات (`AdminRequestsTable`) لاستخدام `Link` الداخلي وإضافة تعريف مسار React Router `"/admin/requests/:id"` حتى لا يُعاد التوجيه إلى `/admin/dashboard` عند فتح التفاصيل.
- تحسين تجربة المستثمر في صفحة `HomePage` بعرض صورة الخبر من Supabase (مع شعار باكورة كنسخة احتياطية)، وإظهار مقتطف وزر "عرض التفاصيل" الذي ينتقل إلى مسار جديد `/news/{id}`.
- تعريف مسارات المستثمر للأخبار (`/news` و`/news/:id`) وتحديث صفحة `InvestorNewsDetailPage` كي تعتمد `useParams` وتعرض شعار باكورة عند غياب الصورة، مع زر رجوع يعمل عبر `Link` بدلاً من رابط خارجي.

## تحديثات 15 نوفمبر 2025

- دعم عرض كل الصور والملفات المرفقة للأخبار الداخلية عبر `InvestorInternalNewsPage` بما في ذلك معرض صور مبني على روابط Supabase موقعة وقسم كامل لتنزيل الملفات بدون حد أقصى لعدد العناصر الظاهرة في البطاقة.
- إتاحة عرض وتنزيل المرفقات في صفحة تفاصيل الأخبار العامة (`InvestorNewsDetailPage`) مع تقسيم تلقائي بين الصور والملفات، وإظهار حجم الملف ونوعه وزر تنزيل يعمل باللغتين.
- توسيع مخارج واجهة `/investor/internal-news` و`/news/:id` لإرجاع المرفقات مع روابط موقعة عبر تحديثات `news.service.ts` وأنواع `PublicNewsDetail` و`InvestorNewsDetail` لضمان اتساق الواجهة الأمامية مع البيانات الجديدة.

